<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <style type="text/css"><!--
	.code {
	  border: 2px dotted;

	  font-family: Courier,monospace;
	  font-size: 90%;

	  background-color: #E0E0E0;
	  margin-left: 10;
	  margin-right: 10;
	  padding-left: 10;
	  padding-right: 10;
	  padding-top: 0;
	  padding-bottom: 10;
	}
    a { text-decoration: none; color: #0000cc }
    a:hover { text-decoration: underline; color: #0000cc; }
  --></style>
<title>Spyce - Python Server Pages (PSP)</title>
  <meta NAME="LANGUAGE" CONTENT="en-US">
  <meta NAME="RATING" CONTENT="GENERAL">
  <meta NAME="ROBOTS" CONTENT="ALL">
  <meta name="abstract" content="Spyce is a server-side language that supports simple and efficient Python-based dynamic HTML generation. Those who like Python and are familiar with JSP, or PHP, or ASP, should have a look at Spyce.">
  <meta name="description" content="Spyce - Python Server Pages: a server-side language that supports simple and efficient Python-based dynamic HTML generation.">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta HTTP-EQUIV="Refresh" CONTENT="1800">
  <meta HTTP-EQUIV="Revisit-After" CONTENT="15 days">
  <link rel="icon" href="spycefav.ico" type="image/x-icon">
  <link rel="shortcut icon" href="spycefav.ico" type="image/x-icon">
<link rel="Next" href="doc-None.html">
<link rel="next" href="doc-None.html">
<link rel="Previous" href="doc-None.html">
<link rel="Prev" href="doc-None.html">
<link rel="prev" href="doc-None.html">
<link rel="Contents" href="doc.html">
<link rel="contents" href="doc.html">
</head>

<body bgcolor="#efefef">

<table border=0 cellspacing=0 cellpadding=0 width="100%"><tr><td valign=top>

<!-- links section -->

<!-- index -->
<table border=0 align=center width="100%"><tr><td align=center nowrap>
  <a href="http://spyce.sourceforge.net"><img src="/spyce.gif" border=0 alt="spyce" width=58 height=70></a>
</td></tr></table>

<table align=center border=1 cellpadding=4 cellspacing=0 bgcolor="#CCCCCC">
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
<b><a href="/index.html">home</a></b><br>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="http://svn-hosting.com/svn/spyce/trunk/spyce/CHANGES">changelog</a></b><br>
<b><a href="/docs/license.html">license</a></b><br>
<b><a href="/docs/get.html">download</a></b><br>
<b><a href="/docs/mail.html">community</a></b><br>
<b><a href="/docs/wishlist.html">wishlist</a></b><br>
  </font>
</td></tr>
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/doc.html">documentation</a></b><br>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/doc-intro.html">intro</a></b><br>
<b><a href="/docs/doc-lang.html">language</a></b><br>
<b><a href="/docs/doc-runtime.html">runtime</a></b><br>
<b><a href="/docs/doc-mod.html">modules</a></b><br>
<b><a href="/docs/doc-tag.html">tags</a></b><br>
<b><a href="/docs/doc-conf.html">install</a></b><br>
<b><a href="/docs/eg.html">examples list</a></b><br>
  </font>
</td></tr>
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
      <b>other</b>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/links.html">resources</a></b><br>
<b><a href="http://sourceforge.net/projects/spyce/">sf project</a></b><br>
<b><a href="http://spyced.blogspot.com/">spyced blog</a></b><br>
  </font>
</td></tr></table><br>

<!-- spacers -->
</td>
<td width=15><img src=/trans1x1.gif width=15 height=1 ></td>
<td width=1 bgcolor="#888888"><img src=/trans1x1.gif width=1 height=1 ></td>
<td width=15><img src=/trans1x1.gif width=15 height=1 ></td>
<td width="100%" valign=top>

<!-- page title -->
<table border=0 width="100%"><tr>
  <td nowrap valign=bottom>
    <b><font face="arial, helvetica" size="-1"><big>Documentation</big></font></b><br clear=all>
  </td>
  <td align=right nowrap valign=bottom>
    <font face="arial, helvetica" size="-1">
    <b><big>[[ <font face="arial, helvetica" color="#cc0000">Spyce</font> ]]</big></b><br>
    </font>
</tr></table>

<hr>
<font face="arial, helvetica" size="-1">

<!-- body -->

<table width="100%" align=center><tr>
    <td align=left width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Prev:</b> None</font></td>
    <td align=center width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Up:</b> None</font></td>
    <td align=right width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Next:</b> None</font></td>
</tr></table>
<hr>
<big><a name="mod_new"></a><b>4.17. <font color=#ee0000>Writing Modules</font></b></big><p>


Writing your own Spyce modules is simple. Let us begin with a basic example
called myModule. It is a module that implements one function named foo().

<table border=1 align=center>
<tr><td align=left bgcolor="#cccccc">
  <font face="arial, helvetica" size="-1"><b>examples/myModule.py</b></font>
</td></tr><tr><td>
  <font face=courier>

    
<style>    
.STRING {
  color: #a0522d;
}
.COMMENT {
  color: #ff7448;
  font-family: serif;
}
.KEYWORD {
  color: #9e79af;
}
.FUNCTION {
  color: #0074ef;
}
</style>
<pre>
<span class="KEYWORD">from</span> <span class="NAME">spyceModule</span> <span class="KEYWORD">import</span> <span class="NAME">spyceModule</span><span class="NEWLINE">
</span><span class="NL">
</span><span class="KEYWORD">class</span> <span class="FUNCTION">myModule</span><span class="OP">(</span><span class="NAME">spyceModule</span><span class="OP">)</span><span class="OP">:</span><span class="NEWLINE">
</span><span class="INDENT">  </span><span class="KEYWORD">def</span> <span class="FUNCTION">foo</span><span class="OP">(</span><span class="NAME">self</span><span class="OP">)</span><span class="OP">:</span><span class="NEWLINE">
</span><span class="INDENT">    </span><span class="KEYWORD">print</span> <span class="STRING">'foo called'</span><span class="NEWLINE">
</span><span class="NL">
</span><span class="DEDENT"></span><span class="DEDENT"></span><span class="ENDMARKER"></span>
</pre>
    
  </font>

</td></tr></table>
<p>
Saving this code in <font face=courier>myModule.py</font> in the same
directory as the Spyce script, or somewhere on the module path, we could use
it as expected: <p>
<table align=center border=0><tr><td><font face=courier>

<b><pre>[[.import name=myModule]]
[[ myModule.foo() ]]
</pre></b>
</font></td></tr></table>
<p>
A Spyce module can be any Python class that derives from
<b>spyceModule.spyceModule</b>. When it is loaded, Spyce assigns it a
__file__ attribute indicating its source location.
Do not override the <b> __init__(...)</b>
method because it is inherited from spyceModule and has an fixed signature
that is expected by the Spyce engine's module loader. The inherited method
accepts a Spyce API object, a <a
href="http://www.python.org/doc/current/lib/module-Bastion.html">Bastion</a>
of <b>spyce.spyceWrapper</b>, an internal engine object, and stores it in
<b>self._api</b>. This is the building block for all the functionality that
any module provides. The available API methods of the wrapper are (listed in
spyceModule.spyceModuleAPI):
<ul>

<li> <b>getFilename</b>: </li>

<li> <b>getCode</b>: </li>

<li> <b>getCodeRefs</b>: </li>

<li> <b>getModRefs</b>: </li>

<li> <b>getServerObject</b>: </li>

<li> <b>getServerGlobals</b>: </li>

<li> <b>getServerID</b>: </li>

<li> <b>getModules</b>: </li>

<li> <b>getModule</b>: </li>

<li> <b>setModule</b>: </li>

<li> <b>getGlobals</b>: </li>

<li> <b>registerModuleCallback</b>: </li>

<li> <b>unregisterModuleCallback</b>: </li>

<li> <b>getRequest</b>: </li>

<li> <b>getResponse</b>: </li>

<li> <b>setResponse</b>: </li>

<li> <b>registerResponseCallback</b>: </li>

<li> <b>unregisterResponseCallback</b>: </li>

<li> <b>spyceString</b>: </li>

<li> <b>spyceFile</b>: </li>

<li> <b>spyceModule</b>: </li>

<li> <b>spyceTaglib</b>: </li>

<li> <b>setStdout</b>: </li>

<li> <b>getStdout</b>: </li>

</ul> <p>
For convenience, one can sub-class the <b>spyceModulePlus</b> class instead of
the regular <b>spyceModule</b>. The spyceModulePlus defines a
<b>self.modules</b> field, which can be used to acquire references to other
modules loaded into the Spyce environment. The <i>response</i> module, for
instance, would be referenced as <i>self.modules.response</i>. Modules are
loaded on demand, if necessary. The spyceModulePlus also contains a
<b>self.globals</b> field, which is a reference to the Spyce global namespace
dictionary, though this should rarely be needed. <p>
<b>Note:</b> It is not expected that many module writers will need the entire
API functionality. In fact, the vast majority of modules will use a small
portion of the API, if at all. Many of these functions are included for just
one of the standard Spyce modules that needs to perform some esoteric
function. <p>
Three Spyce module methods, <b>start()</b>, <b>init([args])</b> and
<b>finish(error)</b> are special in that they are automatically called by the
runtime during Spyce request startup, processing and cleanup, respectively.
The modules are started in the order in which module directives appear in the
file, before processing begins. The implicitly loaded modules are always
loaded first. The init method is called during Spyce processing at the
location of the module directive in the file, with the optional args attribute
is passed as the arguments of this call. Finally, after Spyce processing is
complete, the modules are finalized in reverse order. If there is an unhandled
exception, it will be wrapped in a spyce.spyceException object and passed as
the first parameter to finish(). During successful completion of Spyce
processing (i.e. without exception), the error parameter is None. The default
inherited start, init and finish methods from spyceModule are noops. <p>
<b>Note 2:</b> When writing a Spyce module, consider carefully why you are
selecting a Spyce module over a regular Python module. If it is just code,
that does not interact with the Spyce engine, then a regular Python <font
face=courier>import</font> instead of an Spyce <font
face=courier>[[.import]]</font> can just as easily bring in the necessary
code, and is preferred. In other words, choose a Spyce module only when there
is a need for per-request initialization or for one of the engine APIs. <p>
Module writers are encouraged to look at the existing standard modules as
examples and the definitions of the core Spyce objects in <font
face=courier>spyce.py</font> as well. If you write or use a novel Spyce
module that you think is of general use, please email your <a
href="/contrib">contribution</a>, or
a link to it. Also, please keep in mind that the standard modules are designed
with the goal of being minimalist. Much functionality is readily available
using the Python language libraries. If you think that they should be
expanded, also please send a note. <p>
<hr>

<table width="100%" align=center><tr>
    <td align=left width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Prev:</b> None</font></td>
    <td align=center width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Up:</b> None</font></td>
    <td align=right width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Next:</b> None</font></td>
</tr></table>
<!-- end body -->
<p>
</font>
</td></tr>
<tr><td colspan=5><hr></td></tr>
<tr><td colspan=5 height=15></td></tr>
<tr><td colspan=5>

  <table width="100%" border=0><tr>
    <td align=left valign=top>
      <font face="arial, helvetica" size="-1">
      <b><big>[[ <font face="arial, helvetica" color="#cc0000">Spyce</font> ]]</big></b><br>
      <small>Python Server Pages<br>version 2.0.3</small>
      </font>
    </td><td align=center valign=top>
      <a href="http://spyce.sourceforge.net"><img align=middle width=120 height=50 border=0 src="/spycepow.gif" alt="Spyce Powered"></a>
      <a href="http://sourceforge.net"><img align=middle src="http://sourceforge.net/sflogo.php?group_id=53655&amp;type=5" width="141" height="50" border="0" alt="SourceForge Logo"></a>
    </td><td align=right valign=top>
    </td>
  </tr></table>

</td></tr></table>

</body></html>
