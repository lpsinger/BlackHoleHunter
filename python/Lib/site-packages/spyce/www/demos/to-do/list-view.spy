[[.import name=tododata as=data ]]
[[\
  todo = data.get(request['todoid'])
]]
<spy:parent src=parent.spi title="=todo.description" />

<f:form>
<f:hidden name=todoid value="=todo.id()" />

<h2>Items in this list:</h2>
<ul>
  [[ for item in todo.items:{ ]]
  <li>[[ if item.done:{ ]]<s>[[ } ]]
      [[= item.description ]]
      [[ if item.done:{ ]]</s>
      [[ } else:{ ]]
        <f:checkbox name=itemid value="=item.id()" checked="=0" />
      [[ } ]]
  [[ } ]]
  
  [[ if 'item' not in locals():{ ]]
  <li>(No items yet)
  [[ } ]]
</ul>

<h2>Item Actions</h2>
<ul>
  [[ if len([item for item in todo.items if not item.done]):{ ]]
  <li><f:submit handler=model.item_markdone value="Mark selected as finished" />
  [[ } ]]

  <li><f:submit handler=model.item_new value="New item" />:
  <f:text name=description value="" />
</ul>

</f:form>

[[-- separate form for editing list so description textfields don't get confused --]]
<f:form>
<f:hidden name=todoid value="=todo.id()" />
<h2>List Actions</h2>
<ul>
  <li><f:submit handler=model.list_edit value="Edit description" />:
  <f:text name=description value="=todo.description" />
  <li><a href=index.spy>Todo home</a>
</ul>
</f:form>

