<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <style type="text/css"><!--
	.code {
	  border: 2px dotted;

	  font-family: Courier,monospace;
	  font-size: 90%;

	  background-color: #E0E0E0;
	  margin-left: 10;
	  margin-right: 10;
	  padding-left: 10;
	  padding-right: 10;
	  padding-top: 0;
	  padding-bottom: 10;
	}
    a { text-decoration: none; color: #0000cc }
    a:hover { text-decoration: underline; color: #0000cc; }
  --></style>
<title>Spyce - Python Server Pages (PSP)</title>
  <meta NAME="LANGUAGE" CONTENT="en-US">
  <meta NAME="RATING" CONTENT="GENERAL">
  <meta NAME="ROBOTS" CONTENT="ALL">
  <meta name="abstract" content="Spyce is a server-side language that supports simple and efficient Python-based dynamic HTML generation. Those who like Python and are familiar with JSP, or PHP, or ASP, should have a look at Spyce.">
  <meta name="description" content="Spyce - Python Server Pages: a server-side language that supports simple and efficient Python-based dynamic HTML generation.">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta HTTP-EQUIV="Refresh" CONTENT="1800">
  <meta HTTP-EQUIV="Revisit-After" CONTENT="15 days">
  <link rel="icon" href="spycefav.ico" type="image/x-icon">
  <link rel="shortcut icon" href="spycefav.ico" type="image/x-icon">
<link rel="Next" href="doc-None.html">
<link rel="next" href="doc-None.html">
<link rel="Previous" href="doc-None.html">
<link rel="Prev" href="doc-None.html">
<link rel="prev" href="doc-None.html">
<link rel="Contents" href="doc.html">
<link rel="contents" href="doc.html">
</head>

<body bgcolor="#efefef">

<table border=0 cellspacing=0 cellpadding=0 width="100%"><tr><td valign=top>

<!-- links section -->

<!-- index -->
<table border=0 align=center width="100%"><tr><td align=center nowrap>
  <a href="http://spyce.sourceforge.net"><img src="/spyce.gif" border=0 alt="spyce" width=58 height=70></a>
</td></tr></table>

<table align=center border=1 cellpadding=4 cellspacing=0 bgcolor="#CCCCCC">
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
<b><a href="/index.html">home</a></b><br>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="http://svn-hosting.com/svn/spyce/trunk/spyce/CHANGES">changelog</a></b><br>
<b><a href="/docs/license.html">license</a></b><br>
<b><a href="/docs/get.html">download</a></b><br>
<b><a href="/docs/mail.html">community</a></b><br>
<b><a href="/docs/wishlist.html">wishlist</a></b><br>
  </font>
</td></tr>
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/doc.html">documentation</a></b><br>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/doc-intro.html">intro</a></b><br>
<b><a href="/docs/doc-lang.html">language</a></b><br>
<b><a href="/docs/doc-runtime.html">runtime</a></b><br>
<b><a href="/docs/doc-mod.html">modules</a></b><br>
<b><a href="/docs/doc-tag.html">tags</a></b><br>
<b><a href="/docs/doc-conf.html">install</a></b><br>
<b><a href="/docs/eg.html">examples list</a></b><br>
  </font>
</td></tr>
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
      <b>other</b>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/links.html">resources</a></b><br>
<b><a href="http://sourceforge.net/projects/spyce/">sf project</a></b><br>
<b><a href="http://spyced.blogspot.com/">spyced blog</a></b><br>
  </font>
</td></tr></table><br>

<!-- spacers -->
</td>
<td width=15><img src=/trans1x1.gif width=15 height=1 ></td>
<td width=1 bgcolor="#888888"><img src=/trans1x1.gif width=1 height=1 ></td>
<td width=15><img src=/trans1x1.gif width=15 height=1 ></td>
<td width="100%" valign=top>

<!-- page title -->
<table border=0 width="100%"><tr>
  <td nowrap valign=bottom>
    <b><font face="arial, helvetica" size="-1"><big>Documentation</big></font></b><br clear=all>
  </td>
  <td align=right nowrap valign=bottom>
    <font face="arial, helvetica" size="-1">
    <b><big>[[ <font face="arial, helvetica" color="#cc0000">Spyce</font> ]]</big></b><br>
    </font>
</tr></table>

<hr>
<font face="arial, helvetica" size="-1">

<!-- body -->

<table width="100%" align=center><tr>
    <td align=left width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Prev:</b> None</font></td>
    <td align=center width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Up:</b> None</font></td>
    <td align=right width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Next:</b> None</font></td>
</tr></table>
<hr>
<big><a name="mod_automaton"></a><b>4.15. <font color=#ee0000>Automaton</font></b></big><p>


<i>The current release of the automaton module is preliminary and is still in
flux.</i> The automaton module provides support for state machine-based
application design, which is often useful when designing websites with
application flows. The state machine is a directed, labelled graph. It has
states (nodes with names), and transitions (directed edges with names). One of
the states is defined to be a <b>begin</b> state for the machine. Every state
has a <b>send</b> function, a <b>receive</b> function and a set of outgoing
edges.<p>
The basic idea behind the operation of the automaton module is as follows: The
application is at some state when a request comes in. The receive function for
that state is invoked to process the input from the browser. Based on this
input the receive function returns some edge label, which takes the
application from the current state to its new state. The send function of this
new state is invoked to emit the appropriate application page. The data that
returns from this page will be processed by the corresponding receive
function, and so on. All you need to remember between requests is which state
the application is in, which can be done via get or post, or via cookies using
the cookie module. Better yet (to keep application states private and on the
server for security reasons), one can store the state label in the session
using the session module. <p>
A state machine can be defined programmatically using the following functions:
<ul>
<li><b>state</b>( name, send, recv ): <br> Add a new state labelled
<b>name</b> with associated <b>send</b> and <b>recv</b> functions. </li><p>
<li><b>transition</b>( state1, name, state2 ): <br> Add a new edge labelled
<b>name</b> from <b>state1</b> to <b>state2</b>. There is always a
self-referencing edge with the label None, but this can be overidden.
</li><p>
<li><b>begin</b>( state ): <br> Define a given state to be the begin state.
</li><p>
<li><b>define</b>( sm, begin ): <br> Define an entire automaton <b>sm</b>
all at once, where sm is a hashtable. The keys are the states and the values
are triplets with a send function, a receive function and an edge hashtable.
The edge hashtable has names of the edges as keys and the target states as
values. The <b>begin</b> state is given. </li><p>
</ul>
<p>
To step through the state machine transitions, you call:
<ul>
<li><b>step</b>( [state] ): <br> If <b>state</b> is specified, then call the
receive function of that state. The receive function returns an edge label,
which points to the new state. If no state is specified, just set the new
state to the begin state of the automaton. Then, call the send function of
the new state. Note that the send function is responsible for encoding its
own state label, for use on the subsequent client request. </li><p>
</ul>
<p>
Future releases of this module may add support for different types of send and
receive handlers. For example, it is probably useful to be able to internally
redirect to various Spyce pages for send processing, rather than inline
functions. It may also be possible to pass information among the different
functions, which could be useful, for example, in handling error messages
during form processing. It may also be useful to define a sequence of states,
where previous and next are implicit edges.<p>
The following examples, shows the above in action:<p>

<table border=1 align=center>
<tr><td align=left bgcolor="#cccccc">
  <font face="arial, helvetica" size="-1"><b>examples/automaton.spy</b></font>
</td></tr><tr><td>
  <font face=courier>

    <pre><font color="#000000"><b><font color="#CC00CC">[[.import name=automaton]]</font>
<font color="#CC00CC">[[.import name=session args=&quot;'session_dir', '/tmp', auto=10&quot;]]</font>
<font color="#0000CC">[[\
if not session.auto: session.auto = {
  'name': '',
}

step1send = <font color="#000000"><b>[[spy:
  &lt;html&gt;&lt;body&gt;
    &lt;form action=automaton.spy method=post&gt;
      &lt;table border=0&gt;
        &lt;tr&gt;&lt;td colspan=2&gt;Name: &lt;input type=text size=20&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;
          &lt;input type=hidden name=state value=step1&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td align=right&gt;&lt;input type=submit name=dir value=&quot;next&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;/form&gt;
  &lt;/body&gt;&lt;/html&gt;]]</b></font>
def step1recv():
  if request.post1('dir') == 'next': return 'next'

step2send = <font color="#000000"><b>[[spy:
  &lt;html&gt;&lt;body&gt;
    &lt;form action=automaton.spy method=post&gt;
      &lt;table border=0&gt;
        &lt;tr&gt;&lt;td colspan=2&gt;Age: &lt;input type=text size=20&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;
          &lt;input type=hidden name=state value=step2&gt;
          &lt;td align=left&gt;&lt;input type=submit name=dir value=&quot;prev&quot;&gt;&lt;/td&gt;
          &lt;td align=right&gt;&lt;input type=submit name=dir value=&quot;next&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;/form&gt;
  &lt;/body&gt;&lt;/html&gt;]]</b></font>
def step2recv():
  if request.post1('dir') == 'prev': return 'prev'
  if request.post1('dir') == 'next': return 'next'

step3send = <font color="#000000"><b>[[spy:
  &lt;html&gt;&lt;body&gt;
    &lt;form action=automaton.spy method=post&gt;
      step3
      &lt;input type=hidden name=state value=step3&gt;
      &lt;input type=submit name=dir value=prev&gt;
      &lt;input type=submit name=dir value=next&gt;
    &lt;/form&gt;
  &lt;/body&gt;&lt;/html&gt;]]</b></font>
def step3recv():
  if request.post1('dir') == 'prev': return 'prev'
  if request.post1('dir') == 'next': return 'next'

step4send = <font color="#000000"><b>[[spy:
  &lt;html&gt;&lt;body&gt;
    Thanks.
  &lt;/body&gt;&lt;/html&gt;]]</b></font>
def step4recv():
  pass

automaton.define({
  'step1': ( step1send, step1recv, {
    'next': 'step2',
  }),
  'step2': ( step2send, step2recv, {
    'next': 'step3',
    'prev': 'step1',
  }),
  'step3': ( step3send, step3recv, {
    'next': 'step4',
    'prev': 'step2',
  }),
  'step4': ( step4send, step4recv, {
  }),
}, 'step1')

state = request.post1('state')
automaton.step(state)
]]</font>

<font color="#ff7448">[[--
spyce file
spyce inline
function or method reference
inline code
--]]</font>
</b></font></pre>
  </font>

  </td></tr><tr><td align=right bgcolor="#cccccc">
    <font face="arial, helvetica" size="-1">
      
      <b><a href="examples/automaton.spy">Run this code</a></b>
    </font>

</td></tr></table>
<p>
<hr>

<table width="100%" align=center><tr>
    <td align=left width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Prev:</b> None</font></td>
    <td align=center width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Up:</b> None</font></td>
    <td align=right width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Next:</b> None</font></td>
</tr></table>
<!-- end body -->
<p>
</font>
</td></tr>
<tr><td colspan=5><hr></td></tr>
<tr><td colspan=5 height=15></td></tr>
<tr><td colspan=5>

  <table width="100%" border=0><tr>
    <td align=left valign=top>
      <font face="arial, helvetica" size="-1">
      <b><big>[[ <font face="arial, helvetica" color="#cc0000">Spyce</font> ]]</big></b><br>
      <small>Python Server Pages<br>version 2.0.3</small>
      </font>
    </td><td align=center valign=top>
      <a href="http://spyce.sourceforge.net"><img align=middle width=120 height=50 border=0 src="/spycepow.gif" alt="Spyce Powered"></a>
      <a href="http://sourceforge.net"><img align=middle src="http://sourceforge.net/sflogo.php?group_id=53655&amp;type=5" width="141" height="50" border="0" alt="SourceForge Logo"></a>
    </td><td align=right valign=top>
    </td>
  </tr></table>

</td></tr></table>

</body></html>
