<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <style type="text/css"><!--
	.code {
	  border: 2px dotted;

	  font-family: Courier,monospace;
	  font-size: 90%;

	  background-color: #E0E0E0;
	  margin-left: 10;
	  margin-right: 10;
	  padding-left: 10;
	  padding-right: 10;
	  padding-top: 0;
	  padding-bottom: 10;
	}
    a { text-decoration: none; color: #0000cc }
    a:hover { text-decoration: underline; color: #0000cc; }
  --></style>
<title>Spyce - Python Server Pages (PSP)</title>
  <meta NAME="LANGUAGE" CONTENT="en-US">
  <meta NAME="RATING" CONTENT="GENERAL">
  <meta NAME="ROBOTS" CONTENT="ALL">
  <meta name="abstract" content="Spyce is a server-side language that supports simple and efficient Python-based dynamic HTML generation. Those who like Python and are familiar with JSP, or PHP, or ASP, should have a look at Spyce.">
  <meta name="description" content="Spyce - Python Server Pages: a server-side language that supports simple and efficient Python-based dynamic HTML generation.">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta HTTP-EQUIV="Refresh" CONTENT="1800">
  <meta HTTP-EQUIV="Revisit-After" CONTENT="15 days">
  <link rel="icon" href="spycefav.ico" type="image/x-icon">
  <link rel="shortcut icon" href="spycefav.ico" type="image/x-icon">
<link rel="Next" href="doc-None.html">
<link rel="next" href="doc-None.html">
<link rel="Previous" href="doc-None.html">
<link rel="Prev" href="doc-None.html">
<link rel="prev" href="doc-None.html">
<link rel="Contents" href="doc.html">
<link rel="contents" href="doc.html">
</head>

<body bgcolor="#efefef">

<table border=0 cellspacing=0 cellpadding=0 width="100%"><tr><td valign=top>

<!-- links section -->

<!-- index -->
<table border=0 align=center width="100%"><tr><td align=center nowrap>
  <a href="http://spyce.sourceforge.net"><img src="/spyce.gif" border=0 alt="spyce" width=58 height=70></a>
</td></tr></table>

<table align=center border=1 cellpadding=4 cellspacing=0 bgcolor="#CCCCCC">
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
<b><a href="/index.html">home</a></b><br>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="http://svn-hosting.com/svn/spyce/trunk/spyce/CHANGES">changelog</a></b><br>
<b><a href="/docs/license.html">license</a></b><br>
<b><a href="/docs/get.html">download</a></b><br>
<b><a href="/docs/mail.html">community</a></b><br>
<b><a href="/docs/wishlist.html">wishlist</a></b><br>
  </font>
</td></tr>
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/doc.html">documentation</a></b><br>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/doc-intro.html">intro</a></b><br>
<b><a href="/docs/doc-lang.html">language</a></b><br>
<b><a href="/docs/doc-runtime.html">runtime</a></b><br>
<b><a href="/docs/doc-mod.html">modules</a></b><br>
<b><a href="/docs/doc-tag.html">tags</a></b><br>
<b><a href="/docs/doc-conf.html">install</a></b><br>
<b><a href="/docs/eg.html">examples list</a></b><br>
  </font>
</td></tr>
<tr><td align=left bgColor="#AAAAAA"><b>
  <font face="arial, helvetica" size="-1">
      <b>other</b>
  </font>
</b></td></tr>
<tr><td align=left>
  <font face="arial, helvetica" size="-1">
<b><a href="/docs/links.html">resources</a></b><br>
<b><a href="http://sourceforge.net/projects/spyce/">sf project</a></b><br>
<b><a href="http://spyced.blogspot.com/">spyced blog</a></b><br>
  </font>
</td></tr></table><br>

<!-- spacers -->
</td>
<td width=15><img src=/trans1x1.gif width=15 height=1 ></td>
<td width=1 bgcolor="#888888"><img src=/trans1x1.gif width=1 height=1 ></td>
<td width=15><img src=/trans1x1.gif width=15 height=1 ></td>
<td width="100%" valign=top>

<!-- page title -->
<table border=0 width="100%"><tr>
  <td nowrap valign=bottom>
    <b><font face="arial, helvetica" size="-1"><big>Documentation</big></font></b><br clear=all>
  </td>
  <td align=right nowrap valign=bottom>
    <font face="arial, helvetica" size="-1">
    <b><big>[[ <font face="arial, helvetica" color="#cc0000">Spyce</font> ]]</big></b><br>
    </font>
</tr></table>

<hr>
<font face="arial, helvetica" size="-1">

<!-- body -->

<table width="100%" align=center><tr>
    <td align=left width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Prev:</b> None</font></td>
    <td align=center width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Up:</b> None</font></td>
    <td align=right width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Next:</b> None</font></td>
</tr></table>
<hr>
<big><a name="mod_transform"></a><b>4.8. <font color=#ee0000>Transform</font></b></big><p>


The transform module contains useful text transformation functions, commonly
used during web-page generation. <p>
<ul>
<li><b>html_encode</b>( string, [also] ): <br> Returns a HTML-encoded
<b>string</b>, with special characters replaced by entity references as
defined in the HTML 3.2 and 4 specifications. The optional <b>also</b>
parameter can be used to encode additional characters. </li><p>
<li><b>url_encode</b>( string, ): <br> Returns an URL-encoded <b>string</b>,
with special characters replaced with %XX equivalents as defined by the URI
RFC document. </li><p>
</ul>
The transform module also be used to intercept and insert intermediate
processing steps when <b>response.writeStatic()</b>,
<b>response.writeExpr()</b> and <b>response.write()</b> are called to emit
static html, expressions and dynamic content, respectively. It can be useful,
for example, to automatically ensure that expressions never produce output
that is HTML-unsafe, in other words strings that contain characters such as
&amp;, &lt; and &gt;. Many interesting processing
functions can be defined. By default, the transform module leaves all output
untouched. These processing functions, called filters, can be inserted via the
following module functions: <p>
<ul>
<li><b>static</b>( [ fn ] ): <br> Defines the processing performed on all
static HTML strings from this point forwards. The <b>fn</b> parameter is
explained below.</li><p>
<li><b>expr</b>( [ fn ] ): <br> Defines the processing performed on all the
results of all expression tags from this point forwards. The <b>fn</b>
parameter is explained below.</li><p>
<li><b>dynamic</b>( [ fn ] ): <br> Defines the processing performed on all
dynamic content generated, i.e. content generated using response.write in the
code tags. The <b>fn</b> parameter is explained below. </li><p>
</ul>
<p>
Each of the functions above take a single, optional parameter, which specifies
the processing to be performed. The parameter can be one of the following
types:
<ul>
<li><b>None</b>: <br> If the paramter is None, or omitted, then no processing
is performed other converting the output to a string. </li><p>
<li><b>Function</b>: <br> If a parameter of function type is specified, then
that function is called to process the output. The function input can be any
Python type, and the function output may be any Python type. The result is
then converted into a string and emitted. The first parameter to a filter
will always be the object to be processed for output. However, the function
should be properly defined so as to possibly accept other parameters. The
details of how to define filters are explained below. </li><p>
<li><b>String</b>: <br> If a paramter of string type is specified, then the
string should be of the following format: <font
face=courier>"file:name"</font>, where <b>file</b> is the location where
the function is defined and <b>name</b> is the name of the filter. The file
component is optional, and is searched for using the standard module-finding
rules. If only the function name is specified, then the default location
(inside the transform module itself) is used, where the standard Spyce
filters reside. The standard Spyce filters are described below. </li><p>
<li><b>List</b> / <b>Tuple</b>: <br> If a parameter of list or tuple type is
specified, its elements should be functions, strings, lists or
tuples. The compound filter is recursively defined as
<font face=courier>f=fn(...f2(f1())...)</font>, for the parameter
<font face=courier>(f1,f2,...,fn)</font>.
</li><p>
</ul>
<p>
Having explained how to install filters, we now list the standard Spyce
filters and show how they are used:
<ul>
<li><b>ignore_none</b>( o ): <br> Emits any input <b>o</b> except for None,
which is converted into an empty string. </li><p>
<li><b>truncate</b>( o, [maxlen] ): <br> If <b>maxlen</b> is specified,
then only the first maxlen characters of input <b>o</b> are returned,
otherwise the entire original. </li><p>
<li><b>html_encode</b>( o, [also] ): <br> Converts any '&amp;', '&lt;' and
'&gt;' characters of input <b>o</b> into HTML entities for safe inclusion in
among HTML. The optional <b>also</b> parameter can specify, additional
characters that should be entity encoded.</li><p>
<li><b>url_encode</b>( o ): <br> Converts input <b>o</b> into a URL-encoded
string. </li><p>
<li><b>nb_space</b>( o ): <br> Replaces all spaces in input <b>o</b> with
"&amp;nbsp;". </li><p>
<li><b>silence</b>( o ): <br> Outputs nothing. </li><p>
</ul>
<p>
The optional parameters to some of these filters can be passed to the various
write functions as <b>named parameters</b>. They can also be specified in an
expression tag, as in the following example. (One should simply imagine that
the entire expression tag is replaced with a call to response.writeExpr).
<table align=center border=0><tr><td><font face=courier>

<b><pre>[[.import name=transform]]
[[ transform.expr(("truncate", "html_encode")) ]]
[[='This is an unsafe (&lt; &gt; &amp;) string... '*100, <font color=#ff0000>maxlen=500</font>]] </pre></b>
</font></td></tr></table>
<p>
In the example above, the unsafe string is repeated 100 times. It is then
passed through a <font face=courier>truncate</font> filter that will accept
only the first 500 characters. It is then passed through the <font
face=courier>html_encode</font> filter that will convert the unsafe
characters into their safe, equivalent HTML entities. The resulting string is
emitted.<p>
The parameters (specified by their names) are simply accepted by the
appropriate write method (writeExpr() in the case above) and passed along to
the installed filter. Note that in the case of compound filters, the
parameters are passed to <b>ALL</b> the functions. The html_encode filter is
written to ignore the maxlen parameter, and does not fail. <p>
For those who would like to write their own filters, looking at the definition
of the truncate filter will help. The other standard filters are in <font
face="courier">modules/transform.py</font>.
<table align=center border=0><tr><td><font face=courier>

<b><pre>def truncate(o, maxlen=None, **kwargs):</pre></b>
</font></td></tr></table>
<p>
When writing a filter, any function will do, but it is strongly advised to
follow the model above. The important points are:
<ul>
<li>The input o can be of <b>any type</b>, not only a string.</li>
<li>The function <b>result</b> does not have to be string either. It is
automatically stringified at the end.</li>
<li>The function can accept <b>parameters</b> that modify its behaviour, such
as maxlen, above.</li>
<li>It is recommended to provide convenient user <b>defaults</b> for all
parameters.</li>
<li>The last parameter should be <b>**kwargs</b> so that unneeded parameters
are quietly passed along.</li>
</ul>
<p>
Lastly, one can retrieve filters. This can be useful when creating new
functions that depend on existing filters, but can not be compounded using the
tuple syntax above. For example, one might use one filter or another
conditionally. For whatever purpose, the following module function is provided
to retreive standard Spyce filters, if needed: <p>
<ul>
<li><b>create</b>( [ fn ] ): <br> Returns a filter. The <b>fn</b> parameter
can be of type None, function, string, list or tuple and is handled as in
the installation functions discussed above. </li><p>
</ul>
The transform module is flexible, but not complicated to use. The example
below is <i>not</i> examplary of typical use. Rather it highlights some of the
flexibility, so that users can think about creative uses.<p>

<table border=1 align=center>
<tr><td align=left bgcolor="#cccccc">
  <font face="arial, helvetica" size="-1"><b>examples/transform.spy</b></font>
</td></tr><tr><td>
  <font face=courier>

    <pre><font color="#000000"><b><font color="#CC00CC">[[.import name=transform]]</font>
<font color="#0000CC">[[\
def tag(o, tags=[], **kwargs):
  import string
  pre = string.join(map(lambda x: '&lt;'+x+'&gt;',tags))
  tags.reverse()
  post = string.join(map(lambda x: '&lt;/'+x+'&gt;',tags))
  return pre+str(o)+post
def bold(o, _tag=tag, **kwargs):
  kwargs['tags'] = ['b']
  return apply(_tag, (o,), kwargs)
def bolditalic(o, _tag=tag, **kwargs):
  kwargs['tags'] = ['b','i']
  return apply(_tag, (o,), kwargs)
myfilter = transform.create(['html_encode', bolditalic])
mystring = 'bold and italic unsafe string: &lt; &gt; &amp;'
def simpletable(o, **kwargs):
  s = '&lt;table border=1&gt;'
  for row in o:
    s=s+'&lt;tr&gt;'
    for cell in row:
      s=s+'&lt;td&gt;'+str(cell)+'&lt;/td&gt;'
    s=s+'&lt;/tr&gt;'
  s = s+'&lt;/table&gt;'
  return s
]]</font>
&lt;html&gt;&lt;body&gt;
  install an expression filter:&lt;br&gt;
  <font color="#0000CC">[[transform.expr(['html_encode', tag])]]</font>
  1.<font color="#CC0000">[[=mystring, tags=['b','i'] ]]</font>
  &lt;br&gt;
  <font color="#0000CC">[[transform.expr(myfilter)]]</font>
  2.<font color="#CC0000">[[=mystring]]</font>
  <font color="#0000CC">[[transform.expr()]]</font>
  &lt;p&gt;
  or use a filter directly:&lt;br&gt;
  1.<font color="#CC0000">[[=transform.create(['html_encode',tag])(mystring,tags=['b','i'])]]</font>
  &lt;br&gt;
  2.<font color="#CC0000">[[=myfilter(mystring)]]</font>
  &lt;p&gt;
  Formatting data in a table...&lt;br&gt;
  <font color="#CC0000">[[=simpletable([ [1,2,3], [4,5,6] ])]]</font>
  &lt;p&gt;
  Though the transform module is flexible, &lt;br&gt;
  most users will probably only install the &lt;br&gt;
  &lt;b&gt;html_encode&lt;/b&gt; filter.
&lt;/body&gt;&lt;/html&gt;
</b></font></pre>
  </font>

  </td></tr><tr><td align=right bgcolor="#cccccc">
    <font face="arial, helvetica" size="-1">
      
      <b><a href="examples/transform.spy">Run this code</a></b>
    </font>

</td></tr></table>
 <p>
<hr>

<table width="100%" align=center><tr>
    <td align=left width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Prev:</b> None</font></td>
    <td align=center width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Up:</b> None</font></td>
    <td align=right width="33%" nowrap><font face="arial, helvetica" size="-1"><b>Next:</b> None</font></td>
</tr></table>
<!-- end body -->
<p>
</font>
</td></tr>
<tr><td colspan=5><hr></td></tr>
<tr><td colspan=5 height=15></td></tr>
<tr><td colspan=5>

  <table width="100%" border=0><tr>
    <td align=left valign=top>
      <font face="arial, helvetica" size="-1">
      <b><big>[[ <font face="arial, helvetica" color="#cc0000">Spyce</font> ]]</big></b><br>
      <small>Python Server Pages<br>version 2.0.3</small>
      </font>
    </td><td align=center valign=top>
      <a href="http://spyce.sourceforge.net"><img align=middle width=120 height=50 border=0 src="/spycepow.gif" alt="Spyce Powered"></a>
      <a href="http://sourceforge.net"><img align=middle src="http://sourceforge.net/sflogo.php?group_id=53655&amp;type=5" width="141" height="50" border="0" alt="SourceForge Logo"></a>
    </td><td align=right valign=top>
    </td>
  </tr></table>

</td></tr></table>

</body></html>
